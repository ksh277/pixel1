Toss + ì¹´ì¹´ì˜¤í˜ì´ ì—°ë™ ì‹œìŠ¤í…œ êµ¬ì„±
ì‚¬ìš©ìê°€ ê²°ì œ ì‹œ, ì›í•˜ëŠ” ê²°ì œ ìˆ˜ë‹¨ì„ ì„ íƒí•˜ê³ 
Toss ë˜ëŠ” ì¹´ì¹´ì˜¤í˜ì´ë¡œ ê²°ì œë¥¼ ì§„í–‰ â†’
ê²°ê³¼ë¥¼ Supabaseì— ë°˜ì˜í•˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.

âœ… ê¸°ë³¸ íë¦„
css
ë³µì‚¬
í¸ì§‘
[ì‚¬ìš©ì ì„ íƒ]  
â†’ [ê²°ì œ ìˆ˜ë‹¨: Toss or KakaoPay]  
â†’ [ê²°ì œ ìš”ì²­ (ê° PG SDK í˜¸ì¶œ)]  
â†’ [ì„±ê³µ/ì‹¤íŒ¨ í›„ ë¦¬ë””ë ‰ì…˜]  
â†’ [Supabaseì— ê²°ì œ ìƒíƒœ ë°˜ì˜]
1ï¸âƒ£ í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì„± (ê³µí†µ)
â–¶ï¸ ì„ íƒ UI
tsx
ë³µì‚¬
í¸ì§‘
<Button onClick={() => handlePayment('toss')}>Toss ê²°ì œ</Button>
<Button onClick={() => handlePayment('kakao')}>ì¹´ì¹´ì˜¤í˜ì´</Button>
2ï¸âƒ£ Toss ì—°ë™ (JS SDK ë°©ì‹)
html
ë³µì‚¬
í¸ì§‘
<script src="https://js.tosspayments.com/v1/payment"></script>
ts
ë³µì‚¬
í¸ì§‘
const toss = TossPayments('YOUR_TOSS_CLIENT_KEY');

toss.requestPayment('ì¹´ë“œ', {
  amount: totalPrice,
  orderId: `order_${Date.now()}`,
  orderName: 'í”½ì…€êµ¿ì¦ˆ ì£¼ë¬¸',
  successUrl: 'https://your-site.com/payment-success?toss=1',
  failUrl: 'https://your-site.com/payment-failed?toss=1',
});
3ï¸âƒ£ ì¹´ì¹´ì˜¤í˜ì´ ì—°ë™ (ì„œë²„ ì—°ë™ í•„ìš”)
ì¹´ì¹´ì˜¤í˜ì´ëŠ” ë°±ì—”ë“œ ì„œë²„(Node.js ë“±) í•„ìš”í•©ë‹ˆë‹¤
í”„ë¡ íŠ¸ì—ì„œ ì§ì ‘ ê²°ì œ ìš”ì²­ì€ ë¶ˆê°€í•©ë‹ˆë‹¤.

âœ… ë°±ì—”ë“œ ì˜ˆì‹œ íë¦„
í”„ë¡ íŠ¸ì—ì„œ POST ìš”ì²­ â†’ /api/kakao/pay

ì„œë²„ê°€ ì¹´ì¹´ì˜¤ì— ê²°ì œ ì¤€ë¹„ API í˜¸ì¶œ

ë¦¬í„´ëœ next_redirect_pc_urlë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜

ts
ë³µì‚¬
í¸ì§‘
// Express ì˜ˆì‹œ
app.post('/api/kakao/pay', async (req, res) => {
  const response = await axios.post('https://kapi.kakao.com/v1/payment/ready', null, {
    headers: { Authorization: `KakaoAK ${YOUR_ADMIN_KEY}` },
    params: {
      cid: 'TC0ONETIME',
      partner_order_id: orderId,
      partner_user_id: userId,
      item_name: 'í”½ì…€êµ¿ì¦ˆ ì£¼ë¬¸',
      quantity: 1,
      total_amount: totalPrice,
      tax_free_amount: 0,
      approval_url: 'https://your-site.com/payment-success?kakao=1',
      fail_url: 'https://your-site.com/payment-failed?kakao=1',
      cancel_url: 'https://your-site.com/payment-cancel?kakao=1',
    },
  });

  res.json({ redirectUrl: response.data.next_redirect_pc_url });
});
4ï¸âƒ£ ê²°ì œ ê²°ê³¼ ì²˜ë¦¬ (ê³µí†µ)
âœ… /payment-successì—ì„œ Supabase ì—…ë°ì´íŠ¸
ts
ë³µì‚¬
í¸ì§‘
// ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì—ì„œ PG êµ¬ë¶„
const pg = searchParams.get('toss') ? 'toss' : 'kakao';

await supabase.from('payments').update({
  payment_status: 'success',
  payment_method: pg,
  paid_at: new Date()
}).eq('order_id', orderId);

await supabase.from('orders').update({
  status: 'completed'
}).eq('id', orderId);
5ï¸âƒ£ Supabase í…Œì´ë¸” ë°˜ì˜
payments.payment_method: "toss", "kakao" ì €ì¥

orders.status: "completed"

payments.payment_status: "success" / "failed"

âœ… ìš”ì•½ í”„ë¡¬í”„íŠ¸ (ë¦¬í”Œë¦¿/ê°œë°œìì—ê²Œ ì „ë‹¬)
txt
ë³µì‚¬
í¸ì§‘
Toss Paymentsì™€ KakaoPayë¥¼ ëª¨ë‘ ì§€ì›í•˜ëŠ” ì‹¤ê²°ì œ ì‹œìŠ¤í…œì„ êµ¬í˜„í•´ ì£¼ì„¸ìš”.

1. ì‚¬ìš©ìê°€ ê²°ì œ ìˆ˜ë‹¨ì„ ì„ íƒí•  ìˆ˜ ìˆê²Œ í•´ ì£¼ì„¸ìš”.
2. Toss ê²°ì œëŠ” JS SDK ë°©ì‹ìœ¼ë¡œ ì§„í–‰í•˜ê³ , ì„±ê³µ ì‹œ `/payment-success?toss=1`ìœ¼ë¡œ ë¦¬ë””ë ‰ì…˜
3. ì¹´ì¹´ì˜¤í˜ì´ëŠ” ì„œë²„ API(`/api/kakao/pay`)ë¥¼ í˜¸ì¶œí•´ `next_redirect_pc_url`ë¡œ ì´ë™
4. ê²°ì œ ì„±ê³µ í›„ Supabaseì˜ `payments`, `orders` í…Œì´ë¸”ì„ ì—…ë°ì´íŠ¸ í•´ ì£¼ì„¸ìš”:
   - `payment_status = success`
   - `orders.status = completed`
   - `payment_method = toss` ë˜ëŠ” `kakao`
5. ì‹¤íŒ¨ ì‹œ `/payment-failed` í˜ì´ì§€ë¡œ ì´ë™í•˜ê³  `payment_status = failed` ì²˜ë¦¬
ğŸ’¡ ë³´ì™„ ë° í™•ì¥ ê¸°ëŠ¥
Webhook ê¸°ë°˜ ê²°ì œ ìƒíƒœ í™•ì¸ (PGì‚¬ì—ì„œ push)

ê²°ì œ ë‚´ì—­ ì´ë©”ì¼ ë°œì†¡

ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ê²°ì œ ë‚´ì—­ í™•ì¸

í¬ì¸íŠ¸/ì¿ í° ê²°ì œ ì§€ì›